# 美股投资 Agent

一个基于 Python 的美股中短期交易分析工具，结合技术分析和市场消息面，为投资者提供交易信号和建议。

## 功能特点

### 技术分析
- **移动平均线 (MA)**: 5、10、20、50 日均线，金叉/死叉信号识别
- **RSI 指标**: 超买超卖区域判断，背离信号识别
- **MACD 指标**: 趋势跟踪，金叉/死叉信号
- **布林带**: 波动性分析，突破信号
- **成交量分析**: 放量/缩量判断

### 消息面分析
- 获取股票相关新闻（通过 Finnhub API）
- 情绪分析（支持关键词方法和 FinBERT 模型）
- 正面/负面/中性新闻统计
- 综合情绪得分计算

### 交易信号生成
- 多因子评分系统（技术 60% + 情绪 40%）
- 五级信号：强烈买入、买入、持有、卖出、强烈卖出
- 动态止损位和目标位计算
- 仓位建议和风险评估

### 报告输出
- 彩色终端输出（可选）
- JSON 格式报告保存
- 支持批量分析多只股票

## 安装依赖

### 基础依赖（必需）
```bash
pip install yfinance pandas numpy requests finnhub-python
```

### 高级依赖（可选，用于 FinBERT 情绪分析）
```bash
pip install transformers torch
```

## 配置

### 1. 配置 Finnhub API Key（可选但推荐）

Finnhub 提供免费的股票新闻 API，用于消息面分析。

1. 访问 [Finnhub 官网](https://finnhub.io/register) 注册账号
2. 获取免费 API Key
3. 编辑 `config.py` 文件，将 `FINNHUB_API_KEY` 设置为您的 API Key：

```python
FINNHUB_API_KEY = "your_api_key_here"
```

**注意**: 如果不配置 API Key，程序仍可运行，但会跳过新闻分析，仅使用技术分析。

### 2. 调整配置参数（可选）

您可以在 `config.py` 中调整各种参数：

- **技术分析参数**: RSI 周期、MACD 参数、布林带参数等
- **评分权重**: 技术分析和情绪分析的权重比例
- **风险管理参数**: 止损百分比、ATR 倍数等
- **输出配置**: 是否使用彩色输出、是否保存 JSON 报告等

## 使用方法

### 基本用法

分析单只股票：
```bash
python main.py AAPL
```

分析多只股票：
```bash
python main.py AAPL TSLA NVDA MSFT
```

### 高级选项

使用 FinBERT 模型进行情绪分析（需要安装 transformers 和 torch）：
```bash
python main.py AAPL --finbert
```

禁用彩色输出：
```bash
python main.py AAPL --no-color
```

查看帮助信息：
```bash
python main.py --help
```

## 输出示例

### 终端输出

```
============================================================
美股投资 Agent 分析报告
============================================================

【基本信息】
股票代码: AAPL
公司名称: Apple Inc.
所属行业: Technology - Consumer Electronics
分析时间: 2026-01-04 10:30:00

【价格信息】
当前价格: $271.01
涨跌幅: -0.85 (-0.31%)

【技术分析】
趋势判断: 震荡整理 ~
RSI(14): 31.1 (中性)
MACD: 无明显信号
布林带: 区间内运行
成交量: 正常 (0.9x)

【消息面分析】
最近新闻: 15 条
正面新闻: 10 条
负面新闻: 2 条
中性新闻: 3 条
情绪得分: +65.0 (偏正面)

【综合评分】
技术得分: -10.0
情绪得分: +65.0
综合得分: +20.0

【交易建议】
信号: 持有 🟡
建议操作: 维持现有仓位，观望为主
止损位: $263.02 (-3.0%)
目标位: $287.00 (+5.9%)
建议仓位: 20-30%
风险等级: 中

【关键提示】
  1. 均线呈多头排列，短期趋势向好
  2. 消息面偏正面，市场情绪乐观
  3. 注意大盘整体走势影响
  4. 建议分批建仓，控制风险

【免责声明】
本报告仅供参考，不构成投资建议。
投资有风险，入市需谨慎。请根据自身情况做出投资决策。

============================================================
```

### JSON 报告

程序会自动在 `data/` 目录下保存 JSON 格式的分析报告，文件名格式为 `{股票代码}_{时间戳}.json`。

JSON 报告包含完整的分析数据，方便进一步处理和分析。

## 项目结构

```
us_stock_agent/
├── main.py                    # 主程序入口
├── config.py                  # 配置文件
├── data_fetcher.py           # 数据获取模块
├── technical_analysis.py     # 技术分析模块
├── sentiment_analysis.py     # 情绪分析模块
├── signal_generator.py       # 信号生成模块
├── report_generator.py       # 报告生成模块
├── requirements.txt          # 依赖包列表
├── README.md                 # 使用文档
├── data/                     # JSON 报告保存目录
└── cache/                    # 数据缓存目录
```

## 技术指标说明

### 综合评分系统

综合评分范围为 -100 到 +100，由以下部分组成：

- **技术分析得分** (权重 60%):
  - 均线排列: ±30 分
  - 均线金叉/死叉: ±20 分
  - MACD 信号: ±20 分
  - RSI 状态: ±15 分
  - 布林带位置: ±10 分
  - 成交量: ±5 分

- **情绪分析得分** (权重 40%):
  - 基于新闻正负面比例计算
  - 范围: -100 到 +100

### 信号分类

| 综合得分 | 信号类型 | 建议操作 |
|---------|---------|---------|
| > 60 | 强烈买入 🟢🟢 | 建议积极建仓或加仓 |
| 30 ~ 60 | 买入 🟢 | 可考虑建仓或小幅加仓 |
| -30 ~ 30 | 持有 🟡 | 维持现有仓位，观望为主 |
| -60 ~ -30 | 卖出 🔴 | 建议减仓或离场观望 |
| < -60 | 强烈卖出 🔴🔴 | 建议清仓离场 |

### 风险管理

- **止损位**: 基于 ATR 或固定百分比（默认 3%）计算
- **目标位**: 基于风险回报比 1:2 计算
- **仓位建议**: 根据综合得分动态调整（0-50%）
- **风险等级**: 基于波动率（ATR）评估

## 注意事项

1. **数据来源**: 
   - 股票价格数据来自 Yahoo Finance（通过 yfinance 库）
   - 新闻数据来自 Finnhub API（需要配置 API Key）

2. **数据延迟**: 
   - Yahoo Finance 提供的数据可能有 15-20 分钟延迟
   - 免费的 Finnhub API 有调用频率限制（60 次/分钟）

3. **缓存机制**: 
   - 程序会缓存数据 1 小时，减少 API 调用
   - 缓存文件保存在 `cache/` 目录

4. **适用范围**: 
   - 本工具适用于美股市场
   - 主要针对中短期交易（持仓周期 3-20 天）
   - 不适用于高频交易或长期投资

5. **免责声明**: 
   - 本工具仅供学习和研究使用
   - 所有分析结果仅供参考，不构成投资建议
   - 投资有风险，请根据自身情况谨慎决策

## 常见问题

### Q: 为什么没有新闻数据？
A: 需要配置 Finnhub API Key。请访问 https://finnhub.io/register 注册并获取免费 API Key，然后在 `config.py` 中配置。

### Q: 如何使用 FinBERT 模型？
A: 首先安装依赖 `pip install transformers torch`，然后运行时添加 `--finbert` 参数。注意：首次使用会下载模型（约 400MB），需要一定时间。

### Q: 可以分析中国 A 股吗？
A: 不可以。本工具仅支持美股市场。如需分析 A 股，需要修改数据源。

### Q: 综合得分如何计算？
A: 综合得分 = 技术分析得分 × 0.6 + 情绪分析得分 × 0.4。您可以在 `config.py` 中调整权重比例。

### Q: 如何调整技术指标参数？
A: 编辑 `config.py` 文件中的 `TECHNICAL_CONFIG` 部分，可以调整 RSI 周期、MACD 参数、布林带参数等。

## 进阶使用

### 自定义评分权重

编辑 `config.py` 中的 `SCORING_CONFIG`：

```python
SCORING_CONFIG = {
    "technical_weight": 0.7,      # 提高技术分析权重
    "sentiment_weight": 0.3,      # 降低情绪分析权重
}
```

### 调整信号阈值

编辑 `config.py` 中的 `SIGNAL_THRESHOLDS`：

```python
SIGNAL_THRESHOLDS = {
    "strong_buy": 70,      # 提高强烈买入阈值
    "buy": 40,             # 提高买入阈值
    "sell": -40,           # 降低卖出阈值
    "strong_sell": -70,    # 降低强烈卖出阈值
}
```

### 批量分析并保存结果

```bash
# 分析多只股票并将输出保存到文件
python main.py AAPL MSFT GOOGL AMZN TSLA > analysis_report.txt
```

### 定时自动分析

可以使用 cron 或其他定时任务工具，定期运行分析：

```bash
# 每天美股收盘后运行分析
0 17 * * 1-5 cd /path/to/us_stock_agent && python main.py AAPL TSLA
```

## 许可证

本项目仅供学习和研究使用。

## 贡献

欢迎提出建议和改进意见！

## 联系方式

如有问题或建议，请通过 GitHub Issues 联系。
